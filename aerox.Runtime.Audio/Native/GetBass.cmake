set(OUTPUT_DIR ${CMAKE_CURRENT_SOURCE_DIR}/bin)
set(DOWNLOAD_DIR ${CMAKE_CURRENT_SOURCE_DIR}/_dl)

if(NOT EXISTS ${OUTPUT_DIR})
    file(MAKE_DIRECTORY ${OUTPUT_DIR})
    set(DOWNLOADED_FILE ${DOWNLOAD_DIR}/bass.zip)
    set(EXTRACTED_FOLDER ${DOWNLOAD_DIR}/bass)
    if(WIN32)
      file(DOWNLOAD https://www.un4seen.com/files/bass24.zip ${DOWNLOADED_FILE} SHOW_PROGRESS)
      file(ARCHIVE_EXTRACT INPUT ${DOWNLOADED_FILE} DESTINATION ${EXTRACTED_FOLDER})
      file(COPY ${EXTRACTED_FOLDER}/x64/bass.dll DESTINATION ${OUTPUT_DIR})
    elseif(LINUX)
      file(DOWNLOAD https://www.un4seen.com/files/bass24-linux.zip ${DOWNLOADED_FILE} SHOW_PROGRESS)
      file(ARCHIVE_EXTRACT INPUT ${DOWNLOADED_FILE} DESTINATION ${EXTRACTED_FOLDER})
      file(COPY ${EXTRACTED_FOLDER}/libs/x86_64/libbass.so DESTINATION ${OUTPUT_DIR})
    elseif(APPLE)
      file(DOWNLOAD https://www.un4seen.com/files/bass24-osx.zip ${DOWNLOADED_FILE} SHOW_PROGRESS)
      file(ARCHIVE_EXTRACT INPUT ${DOWNLOADED_FILE} DESTINATION ${EXTRACTED_FOLDER})
      file(COPY ${EXTRACTED_FOLDER}/libbass.dylib DESTINATION ${OUTPUT_DIR})
    endif()
    file(REMOVE_RECURSE ${DOWNLOAD_DIR})
endif()